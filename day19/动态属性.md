# 动态属性

Python 语言属于动态语言，维基百科对动态语言的解释是：“在运行时可以改变其结构的语言，例如新的函数、对象、甚至代码可以被引进，已有的函数可以被删除或是其他结构上的变化”。动态语言非常灵活，目前流行的 Python 和 JavaScript 都是动态语言，除此之外，诸如 PHP、Ruby 等也都属于动态语言，而 C、C++ 等语言则不属于动态语言。

在 Python 中，我们可以动态为对象添加属性，这是 Python 作为动态类型语言的一项特权，代码如下所示。需要提醒大家的是，对象的方法其实本质上也是对象的属性，如果给对象发送一个无法接收的消息，引发的异常仍然是`AttributeError`。

~~~python
class Student:

    def __init__(self, name, age):
        self.name = name
        self.age = age


stu = Student('王大锤', 20)
stu.sex = '男'  # 给学生对象动态添加sex属性
~~~



如果不希望在使用对象时动态的为对象添加属性，可以使用 Python 语言中的`__slots__`魔法。对于`Student`类来说，可以在类中指定`__slots__ = ('name', 'age')`，这样`Student`类的对象只能有`name`和`age`属性，如果想动态添加其他属性将会引发异常，代码如下所示。

~~~python
class Student:
    __slots__ = ('name', 'age')

    def __init__(self, name, age):
        self.name = name
        self.age = age


stu = Student('王大锤', 20)
# AttributeError: 'Student' object has no attribute 'sex'
stu.sex = '男'
~~~





## a. `__slots__` 的作用

使用 `__slots__` 会**严格限制**类实例只能拥有指定的属性，不能动态添加额外的属性。

**示例验证**

```python
class StudentWithSlots:
    __slots__ = ('name', 'age')  # 只允许这两个属性
    
    def __init__(self, name, age):
        self.name = name
        self.age = age

# 创建对象
stu = StudentWithSlots('张三', 20)

# 允许的操作 ✅
stu.name = '李四'    # 修改已有属性
stu.age = 21         # 修改已有属性

# 不允许的操作 ❌
try:
    stu.gender = '男'  # 尝试添加新属性
except AttributeError as e:
    print(f"错误: {e}")  # 'StudentWithSlots' object has no attribute 'gender'

try:
    stu.score = 95    # 尝试添加另一个新属性
except AttributeError as e:
    print(f"错误: {e}")  # 'StudentWithSlots' object has no attribute 'score'
```



## b. 对比无 `__slots__` 的情况

```python
class StudentWithoutSlots:
    def __init__(self, name, age):
        self.name = name
        self.age = age

stu2 = StudentWithoutSlots('王五', 22)

# 所有操作都允许 ✅
stu2.name = '赵六'    # 修改属性 ✅
stu2.gender = '男'    # 添加属性 ✅
stu2.score = 90       # 添加属性 ✅
stu2.city = '北京'    # 添加属性 ✅

print(stu2.__dict__)  # {'name': '赵六', 'age': 22, 'gender': '男', 'score': 90, 'city': '北京'}
```

